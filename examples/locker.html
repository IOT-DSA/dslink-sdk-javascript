<!DOCTYPE html>
<html>
  <style>

body {
  background-color: #F8F8F8;
  font-family: 'Open Sans', sans-serif;
  font-size: 14px;
  font-weight: normal;
  line-height: 1.2em;
  margin: 15px;
}

h1, p {
  color: #333;
}

.sample_container {
  width: 300px;
  height: 300px;
  border: 1px solid #ccc;
  background-color: #fff;
}

.sample_text {
  font-size: 24pt;
  text-align: center;
  margin-top: 140px;
  -webkit-user-select: none;
  user-select: none;
}
input {
  margin-left:70px;
}
</style>
<body>
  <h1>Lockerdemo</h1>

  <p>Demo of 2 lockers</p>

  <div class="sample_container">
    <p class="sample_text" id="opentext1" >Closed</p>
    <input id="openbtn1" type="button" value="Open">
    <input id="closebtn1" type="button" value="Close">
  </div>
  <div class="sample_container">
    <p class="sample_text" id="opentext2" >Closed</p>
    <input id="openbtn2" type="button" value="Open">
    <input id="closebtn2" type="button" value="Close">
  </div>

<script src="../dist/dslink.js"></script>
<script>

document.addEventListener('DOMContentLoaded', function(event) {
  var provider = new DS.NodeProvider();

  var OpenLocker = DS.Node.createNode({
    onInvoke: function(params) {
      // open -> opened
      provider.getNode(this.path() + 'ed').value = new DS.Value(true);
    }
  });

  provider.is('openLocker', OpenLocker);

  provider.load({
    locker1: {
      open: {
        '$invokable': 'read',
        '$is': 'openLocker'
      },
      opened: {
        '$type': 'bool',
        '?value': false
      }
    },
    locker2: {
      open: {
        '$invokable': 'read',
        '$is': 'openLocker'
      },
      opened: {
        '$type': 'bool',
        '?value': false
      }
    }
  });

  var keys = DS.ECDH.importKey('t5YRKgaZyhXNNberpciIoYzz3S1isttspwc4QQhiaVk BJ403K-ND1Eau8UJA7stsYI2hdgiOKhNVDItwg7sS6MfG2iSRGqM2UodSF0mb8GbD8s2OAukQ03DFLULw72bklo');
  var responder = new DS.Responder(new DS.WebSocketClient('locker', 'http://localhost:8080', keys), provider);

  var responder = new DS.Responder(provider);
  var client = new DS.WebSocketClient('locker', responder);

  client.connect({
    hostname: 'http://localhost:8080/conn',
    keys: keys
  }).then(function() {
    provider.getNode('/locker1/opened').on('value', function(update) {
      document.querySelector('#opentext1').innerHTML = update.value === true ? 'Opened' : 'Closed';
    });

    provider.getNode('/locker2/opened').on('value', function(update) {
      document.querySelector('#opentext2').innerHTML = update.value === true ? 'Opened' : 'Closed';
    });

    document.querySelector('#openbtn1').addEventListener('click', function() {
      provider.getNode('/locker1/opened').value = true;
    });

    document.querySelector('#closebtn1').addEventListener('click', function() {
      provider.getNode('/locker1/opened').value = false;
    });

    document.querySelector('#openbtn2').addEventListener('click', function() {
      provider.getNode('/locker2/opened').value = true;
    });

    document.querySelector('#closebtn2').addEventListener('click', function() {
      provider.getNode('/locker2/opened').value = false;
    });
  });
});

</script>
</body>
</html>
